window.NSG = {};

NSG.GAME_DATA = [
  {
    "date": "Saturday, February 9, 2019 5:00PM PST",
    "matchup": "HOUSTON DYNAMO",
    "location": "KINO SPORTS COMPLEX",
    "time_in_milliseconds": 1549756800000
  },
  {
    "date": "Wednesday, February 13, 2019 6:00PM PST",
    "matchup": "PORTLAND TIMBERS",
    "location": "KINO SPORTS COMPLEX",
    "time_in_milliseconds": 1550106000000
  },
  {
    "date": "Saturday, February 16, 2019 9:00AM PST",
    "matchup": "FC DALLAS",
    "location": "KINO SPORTS COMPLEX",
    "time_in_milliseconds": 1550332800000
  },
  {
    "date": "Wednesday, February 20, 2019 7:30PM PST",
    "matchup": "CLUB NACIONAL DE FOOTBALL",
    "location": "CENTURYLINK FIELD, SEATTLE, WA",
    "time_in_milliseconds": 1550716200000
  },
  {
    "date": "Saturday, February 23, 2019 12:45PM PST",
    "matchup": "SAN JOSE EARTHQUAKES",
    "location": "AVAYA STADIUM",
    "time_in_milliseconds": 1550951100000
  },
  {
    "date": "Saturday, March 2, 2019 7:00PM PST",
    "matchup": "FC CINCINNATI",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1551578400000
  },
  {
    "date": "Saturday, March 9, 2019 7:00PM PST",
    "matchup": "COLORADO RAPIDS",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1552183200000
  },
  {
    "date": "Saturday, March 16, 2019 10:00AM PST",
    "matchup": "CHICAGO FIRE",
    "location": "SEATGEEK STADIUM",
    "time_in_milliseconds": 1552755600000
  },
  {
    "date": "Saturday, March 30, 2019 7:00PM PST",
    "matchup": "VANCOUVER WHITECAPS FC",
    "location": "BC PLACE",
    "time_in_milliseconds": 1553997600000
  },
  {
    "date": "Saturday, April 6, 2019 7:00PM PST",
    "matchup": "REAL SALT LAKE",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1554602400000
  },
  {
    "date": "Wednesday, April 10, 2019 6:00PM PST",
    "matchup": "COLORADO RAPIDS",
    "location": "DICK'S SPORTING GOODS PARK",
    "time_in_milliseconds": 1554944400000
  },
  {
    "date": "Saturday, April 13, 2019 1:00PM PST",
    "matchup": "TORONTO FC",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1555185600000
  },
  {
    "date": "Sunday, April 21, 2019 4:00PM PST",
    "matchup": "LOS ANGELES FOOTBALL CLUB",
    "location": "BANC OF CALIFORNIA STADIUM",
    "time_in_milliseconds": 1555887600000
  },
  {
    "date": "Wednesday, April 24, 2019 7:30PM PST",
    "matchup": "SAN JOSE EARTHQUAKES",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1556159400000
  },
  {
    "date": "Sunday, April 28, 2019 12:30PM PST",
    "matchup": "LOS ANGELES FOOTBALL CLUB",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1556479800000
  },
  {
    "date": "Saturday, May 4, 2019 5:00PM PST",
    "matchup": "MINNESOTA UNITED FC",
    "location": "ALLIANZ FIELD",
    "time_in_milliseconds": 1557014400000
  },
  {
    "date": "Saturday, May 11, 2019 7:00PM PST",
    "matchup": "HOUSTON DYNAMO",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1557626400000
  },
  {
    "date": "Wednesday, May 15, 2019 7:30PM PST",
    "matchup": "ORLANDO CITY SC",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1557973800000
  },
  {
    "date": "Saturday, May 18, 2019 4:30PM PST",
    "matchup": "PHILADELPHIA UNION",
    "location": "TALEN ENERGY STADIUM",
    "time_in_milliseconds": 1558222200000
  },
  {
    "date": "Sunday, May 26, 2019 3:00PM PST",
    "matchup": "SPORTING KANSAS CITY",
    "location": "CHILDREN'S MERCY PARK",
    "time_in_milliseconds": 1558908000000
  },
  {
    "date": "Saturday, June 1, 2019 5:00PM PST",
    "matchup": "FC DALLAS",
    "location": "TOYOTA STADIUM",
    "time_in_milliseconds": 1559433600000
  },
  {
    "date": "Wednesday, June 5, 2019 4:30PM PST",
    "matchup": "MONTREAL IMPACT",
    "location": "STADE SAPUTO",
    "time_in_milliseconds": 1559777400000
  },
  {
    "date": "Saturday, June 29, 2019 7:00PM PST",
    "matchup": "VANCOUVER WHITECAPS FC",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1561860000000
  },
  {
    "date": "Wednesday, July 3, 2019 4:00PM PST",
    "matchup": "NEW YORK CITY FC",
    "location": "YANKEE STADIUM",
    "time_in_milliseconds": 1562194800000
  },
  {
    "date": "Saturday, July 6, 2019 4:30PM PST",
    "matchup": "COLUMBUS CREW SC",
    "location": "MAPFRE STADIUM",
    "time_in_milliseconds": 1562455800000
  },
  {
    "date": "Sunday, July 14, 2019 1:00PM PST",
    "matchup": "ATLANTA UNITED FC",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1563134400000
  },
  {
    "date": "Sunday, July 21, 2019 6:30PM PST",
    "matchup": "PORTLAND TIMBERS",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1563759000000
  },
  {
    "date": "Saturday, July 27, 2019 5:00PM PST",
    "matchup": "HOUSTON DYNAMO",
    "location": "BBVA COMPASS STADIUM",
    "time_in_milliseconds": 1564272000000
  },
  {
    "date": "Sunday, August 4, 2019 7:00PM PST",
    "matchup": "SPORTING KANSAS CITY",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1564970400000
  },
  {
    "date": "Saturday, August 10, 2019 1:00PM PST",
    "matchup": "NEW ENGLAND REVOLUTION",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1565467200000
  },
  {
    "date": "Wednesday, August 14, 2019 7:00PM PST",
    "matchup": "REAL SALT LAKE",
    "location": "RIO TINTO STADIUM",
    "time_in_milliseconds": 1565834400000
  },
  {
    "date": "Saturday, August 17, 2019 7:00PM PST",
    "matchup": "LA GALAXY",
    "location": "DIGNITY HEALTH SPORTS PARK",
    "time_in_milliseconds": 1566093600000
  },
  {
    "date": "Friday, August 23, 2019 7:00PM PST",
    "matchup": "PORTLAND TIMBERS",
    "location": "PROVIDENCE PARK",
    "time_in_milliseconds": 1566612000000
  },
  {
    "date": "Sunday, September 1, 2019 3:00PM PST",
    "matchup": "LA GALAXY",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1567375200000
  },
  {
    "date": "Sunday, September 15, 2019 12:30PM PST",
    "matchup": "NEW YORK RED BULLS",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1568575800000
  },
  {
    "date": "Wednesday, September 18, 2019 7:30PM PST",
    "matchup": "FC DALLAS",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1568860200000
  },
  {
    "date": "Sunday, September 22, 2019 5:00PM PST",
    "matchup": "D.C. UNITED",
    "location": "AUDI FIELD",
    "time_in_milliseconds": 1569196800000
  },
  {
    "date": "Sunday, September 29, 2019 4:30PM PST",
    "matchup": "SAN JOSE EARTHQUAKES",
    "location": "AVAYA STADIUM",
    "time_in_milliseconds": 1569799800000
  },
  {
    "date": "Sunday, October 6, 2019 1:00PM PST",
    "matchup": "MINNESOTA UNITED FC",
    "location": "CENTURYLINK FIELD",
    "time_in_milliseconds": 1570392000000
  }
];

window.onload = onPageLoad;

function onPageLoad() {
  renderGame();
  setInterval(renderGame, 1000);
}

NSG.MILLIS_PER_DAY    = 86400000;
NSG.MILLIS_PER_HOUR   = 3600000;
NSG.MILLIS_PER_MINUTE = 60000;
NSG.MILLIS_PER_SECOND = 1000;

function calcTimeDifferences(timeDiffMillis) {
  var days = Math.floor(timeDiffMillis / NSG.MILLIS_PER_DAY);
  var hours = Math.floor(timeDiffMillis % NSG.MILLIS_PER_DAY / NSG.MILLIS_PER_HOUR);
  var minutes = Math.floor(timeDiffMillis % NSG.MILLIS_PER_HOUR % NSG.MILLIS_PER_DAY / NSG.MILLIS_PER_MINUTE);
  var seconds = Math.floor(timeDiffMillis % NSG.MILLIS_PER_HOUR % NSG.MILLIS_PER_DAY % NSG.MILLIS_PER_MINUTE / NSG.MILLIS_PER_SECOND);

  return {
    days: days,
    hours: hours,
    minutes: minutes,
    seconds: seconds
  };
}

function formatTimeDifference(timeDifferences) {
  return '<div class="countdown">' + [
      '<ul class="time-diff-numbers">',
      '<li>', timeDifferences.days, '</li>',
      '<li>', timeDifferences.hours, '</li>',
      '<li>', timeDifferences.minutes, '</li>',
      '<li>', timeDifferences.seconds, '</li>',
      '</ul>'
    ].join('') +
    [
      '<ul class="time-diff-labels">',
      '<li>days</li>',
      '<li>hours</li>',
      '<li>minutes</li>',
      '<li>seconds</li>',
      '</ul>'
    ].join('') +
    '</div>';
}

function getGame(pred) {
  var game;

  for (var i = 0; i < NSG.GAME_DATA.length; i++) {
    game = NSG.GAME_DATA[i];

    if (pred(game)) {
      return game
    }
  }
}

function futureGamePred() {
  var now = new Date().getTime();

  return function(game) {
    return game.time_in_milliseconds > now;
  }
}

function isHomeGame(game) {
  return game.location === 'CENTURYLINK FIELD';
}

function futureHomeGamePred() {
  var isFutureGame = futureGamePred();

  return function(game) {
    return isFutureGame(game) && isHomeGame(game);
  }
}

function renderGame() {
  var countdown = document.getElementsByClassName('countdown')[0];
  var nowMillis = new Date().getTime();
  var nextGame = getGame(futureGamePred());
  var timeDiffMillis = nextGame.time_in_milliseconds - nowMillis;
  var isAwayGame = nextGame.location !== 'CENTURYLINK FIELD';

  countdown.innerHTML = formatTimeDifference(calcTimeDifferences(timeDiffMillis));

  document.getElementsByClassName('game-content')[0].innerHTML = [
    nextGame.date,
    '<br>',
    isAwayGame ? 'at' : 'at home vs', nextGame.matchup
  ].join(' ');

  if (isAwayGame) {
    displayNextHomeGame(nowMillis);
  } else {
    hideHomeGame();
  }
}

function hideHomeGame() {
  document.getElementById('home-game-container').style.display = 'none';
}

function showHomeGame() {
  document.getElementById('home-game-container').style.display = 'block';
}

function displayNextHomeGame(now) {
  var nextHomeGame = getGame(futureHomeGamePred());
  var timeDiffMillis = nextHomeGame.time_in_milliseconds - now;

  showHomeGame();

  document.getElementsByClassName('home-game-header')[0].innerHTML = 'Next <span class="sounders">Home</span> Game';

  document.getElementsByClassName('home-countdown')[0].innerHTML = formatTimeDifference(calcTimeDifferences(timeDiffMillis));

  document.getElementsByClassName('home-game-content')[0].innerHTML = nextHomeGame.date + '<br>' + 'vs ' + nextHomeGame.matchup;
}

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-93146318-1', 'auto');ga('send', 'pageview');
